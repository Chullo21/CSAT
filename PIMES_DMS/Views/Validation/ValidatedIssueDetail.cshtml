@model PIMES_DMS.Models.IssueModel

@{
    ViewData["Title"] = "Validated Issue With Report";

    string setColor;
    if (Model.ValRes == "Valid") setColor = "color:red"; else setColor = "color:green";

    string? emailSnip = ViewBag.EmailSnip as string;
}

<div class="d-flex justify-content-center mt-5">
    <div>
        <h1 style="@setColor">@Model.ValRes Claim</h1>
    </div>
</div>

<hr />
<div class="col-12">
    <div class="row" style="height:500px">
        <div class="col-12 col-md-6">
            <table class="table table-responsive">
                <tr>
                    <th>
                        Issue Creator:
                    </th>
                    <td>
                        @Model.IssueCreator
                    </td>
                </tr>
                <tr>
                    <th>
                        Issue #:
                    </th>
                    <td>
                        @Model.IssueNo
                    </td>
                </tr>
                <tr>
                    <th>
                        Date Found:
                    </th>
                    <td>
                        @Model.DateFound.ToShortDateString()
                    </td>
                </tr>
                <tr>
                    <th>
                        Product:
                    </th>
                    <td>
                        @Model.Product
                    </td>
                </tr>
                <tr>
                    <th>
                        Serial #:
                    </th>
                    <td>
                        @Model.SerialNo
                    </td>
                </tr>
                <tr>
                    <th>
                        Affected P/N:
                    </th>
                    <td>
                        @Model.AffectedPN
                    </td>
                </tr>
                <tr>
                    <th>
                        Description:
                    </th>
                    <td>
                        @Model.Desc
                    </td>
                </tr>
                <tr style="height:auto">
                    <th>
                        Problem Description:
                    </th>
                    <td>
                        @Model.ProbDesc
                    </td>
                </tr>
            </table>
        </div>
        <div class="col-12 col-md-6 d-block justify-content-center" style="background-color:steelblue; border:3px solid">
            <div >
                <p class="fw-bold text-center mt-3">
                    VALIDATION FORM RESULT
                </p>
            </div>
            <div class="flex-column">
                <div class="d-flex align-items-center mt-3 mx-5 mb-2">
                    <label class="form-label fw-bold align-self-center">Report Number:</label>
                    <input class="text-center form-control w-50" style="margin-left:5px" value="@Model.ValNo" readonly />
                </div>
                <div class="mt-3 w-50 mb-2 mx-5">
                    <div class="d-flex justify-content-between">
                        @{
                            if (Model.Report != null)
                            {
                                <div>
                                    <label style="font-weight:bold">Evidence:</label>
                                    <button class="btn btn-primary" onclick="openModal()">View</button>
                                </div>
                            }
                            else
                            {
                                Write("No Attachment");
                            }

                            if (Model.ValRes == "Invalid" && Model.EmailSnip != null)
                            {
                                <div>
                                    <label style="font-weight:bold">Email Snip:</label>
                                    <button class="btn btn-primary" onclick="OpenEmailSnip()">View</button>
                                </div>
                            }
                            else if (Model.ValRes == "Invalid" && Model.EmailSnip == null)
                            {
                                <div style="margin-left:5px">
                                    <label style="font-weight:bold">Add Email Snip:</label>
                                    <button class="btn btn-primary" onclick="openAddEmailSnip()">Add</button>
                                </div>
                            }
                        }
                    </div>
                </div>
                <div class="mx-5 mb-2">
                    <label class="form-label fw-bold">Summary Report:</label>
                    <div>
                        <textarea class="w-100 h-75 mt-2" style="max-height:250px; min-height:250px" readonly>@Model.ValidationRepSum</textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-content w-100 h-100" style="z-index: 2100;" id="showEvidence">
    <button class="modal-close btn btn-danger" onclick="closeModal()">Close</button>
    <div class="modal-header justify-content-center">
        <h4 class="modal-title text-center">Report</h4>
    </div>
    <iframe class="w-100" style="height:90%" src="@Url.Action("ShowPdf", new { id = Model.IssueID, type = "None"})"></iframe>
</div>

<div class="modal-content w-50 h-50" style="z-index: 2100" id="addEmail">
    <button class="btn btn-danger modal-close" onclick="closeAddEmailSnip()">Close</button>
    <h4 class="modal-header text-center">Add Email Snip</h4>
    <form asp-controller="Validation" asp-action="SaveEmailSnip" enctype="multipart/form-data">
        <input value="@Model.IssueID" name="ID" hidden/>
       <div class="align-self-center">
            <label>Upload Email Snip here:</label>
            <input class="form-control" type="file" accept="image/*" name="img" required />
            <input class="btn btn-primary mt-3" type="submit" value="Save" />
       </div>
    </form>
</div>

<div class="modal-content w-75 h-75" style="z-index: 2100" id="openEmail">
    <button class="modal-close btn btn-danger" onclick="CloseEmailSnip()">Close</button>
    <div class="modal-header justify-content-center">
        <h4 class="modal-title text-center ">Email Snip</h4>
    </div>
    <br />
    <div class="w-100 h-100 mt-2">
        <img class="w-100 h-75" id="modalImage" src="@emailSnip" alt="Image">
    </div>
</div>

<script>
    function OpenEmailSnip()
    {
        var emailSnip = document.getElementById('openEmail');

        emailSnip.style.display = "block";
    }

    function CloseEmailSnip()
    {
        var emailSnip = document.getElementById('openEmail');

        emailSnip.style.display = "none";
    }

    function openModal() {
        var eviModal = document.getElementById('showEvidence');
        eviModal.style.display = "block";
    }

    function closeModal() {
        var eviModal = document.getElementById('showEvidence');
        eviModal.style.display = "none";
    }

    function openAddEmailSnip()
    {
        var AddEmailSnip = document.getElementById('addEmail');
        AddEmailSnip.style.display = "block";
    }

    function closeAddEmailSnip() {
        var AddEmailSnip = document.getElementById('addEmail');
        AddEmailSnip.style.display = "none";
    }
</script>

